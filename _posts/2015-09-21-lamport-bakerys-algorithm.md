---
title: 面包店算法
date: 2015-09-21T07:36:41+00:00
layout: post
---
用于多线程操作同一个数据时同步使用。
  
优点在于没有锁。
  
本质在于把pid拿来当比较对象，从而把锁逻辑转嫁给了操作系统。

下面的代码是多线程中的一个线程的逻辑。

<pre>Thread(i) {
    while (true) {
        Enter [i] = 1;
        // 在这里取号，拿到自己的号码
        Number[i] = 1 + max(Number[1],....Number[N]);

        // 开始等待叫号
        Enter [i] = 0;

        for (j=1; j&lt;=N; ++j) {
            // 叫到自己的号之前一直等待
            while (Enter[j] != 0) {
                // 没叫到自己，等
            }

            // 叫到自己了，但是有人和我拿了一样的号
            while ((Number[j]!=0)
                    &#038;&#038; ((Number[j],j) &lt; (Number[i],i))) {
                // 等到我的名字是这几个拿到号的人中最小的，之前一直等
                // 名字可以是pid
            }
        }
        // 办需要互斥的关键性的事
        Number[i] = 0;

        // 这里可以办一些不需要互斥的非关键的事
    }
}

</pre>
