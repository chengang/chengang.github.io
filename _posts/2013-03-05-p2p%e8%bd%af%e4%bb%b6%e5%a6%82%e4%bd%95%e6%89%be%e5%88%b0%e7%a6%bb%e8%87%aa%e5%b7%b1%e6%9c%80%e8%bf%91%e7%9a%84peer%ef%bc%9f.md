---
title: P2P软件如何找到离自己最近的peer？
date: 2013-03-05T14:17:39+00:00
layout: post
---
最近想做一个客户端自主动态选择最近服务器以提供优质上传服务的程序。想着P2P那么多年的发展肯定已经有了相关的沉淀，于是调研了一下流行的P2P协议。

## 问：

P2P软件如何找到离自己最近的peer？

## 答：

**简单地说**，P2P软件没有找到离自己最近的peer。

**复杂地说**，P2P找到自己需要的碎片都已经是一个难题，目前来看找到最近的peer不是最急需研究的问题。

而且，P2P最关心的是_最快_而非_最近_。

目前的P2P应用中，这个问题是通过_&#8220;实际尝试下载后计算速度，然后排序用速度最快的前几名&#8221;_的方式解决的。
  
也就是不妄图直接计算最近的。即使是在美国也去下载，发现慢而后放弃。这个排序同时也受P2P协议中共享度的影响。

**另外**，旧一代的P2P都是有中心而不是纯分布式的。bt的中心服务器叫Tracker，eDonkey的服务器名字未知。
  
P2P软件在开始下载之前都会去这个中心取网络拓扑信息。简单地攻击这个中心就可以让P2P网络瘫痪。
  
这事真发生过：2009年12月，广电总局大范围封锁中国大陆的Tracker服务器，直接导致以BTChina为代表的一批知名Tracker服务器停止服务。

新一代的P2P协议才实现的真正的分布式。bt的叫做DHT，eDonkey叫做KAD（还有Overnet）。
  
实现的方式是在每个小区域里面动态选举一个中心出来，或者是使用动态自治（每个节点管自己周围一小片，配合多层的请求转发）的方式。

## 这次调研还引发了2个感想：

1、P2P比做CDN似乎更考验人的通盘考虑能力呢；
  
2、貌似大多数领域里，想要去中心化都会带来一大堆麻烦。
