---
id: 2747
title: RHCA培训散记（436存储与高可用集群 – 1）
date: 2011-12-05T14:37:42+00:00
author: chen
layout: post
guid: http://blog.yikuyiku.com/?p=2747
permalink: /2747.html
categories:
  - 备忘
tags:
  - 436
  - IPMI
  - RHCA
---
## 概述

**1、用户数据**比系统数据更重要更敏感也更难以恢复；

**2、存储需要考虑的事**：
  
a>安全，需要存取权限的限制么；
  
b>分级，数据的冷热；
  
c>性能，读取数据的开销如何；
  
d>唯一性，还是在别处有拷贝；
  
e>数据是否和架构或应用程序绑定；
  
f>只读存储还是可修改；
  
g>单点失败；
  
h>降低复杂度；
  
i>提高可伸缩性；
  
j>数据完整性；
  
k>为未来的增长规划；

**3、集群存在的目的**：
  
a>分布式计算；
  
b>高可用（RHCS集群主要解决的问题）；
  
c>负载均衡；

**4、vs是versus的缩写**；

**5、SAN**（Storage Area Network）本质上被设计成了另一个独立的网络，出发点有二：
  
a>在独立网络上走SCSI（Small Computer System Interface）协议，此协议被设计成在可靠线路上并行地传输大块数据；
  
b>操作存储的通信数据量很大，这样可避免占用其他通信的开销和带宽；

**6、NAS**（Network Attached Storage）服务器一般跑一个嵌入式的为文件共享而优化的OS，然后后面连一个DAS。本质上是个文件服务器；

**7、LUN** ID相当于是存储的uuid，一般用于在一条并行的SCSI通道中区分数个不同的存储，最后达到多路复用的目的；

**8、SCSI设备和FC设备的区别**：一个FC设备是一个可以在最底层虚拟出一个或多个SCSI设备的抽象设备。其实并不存在一个真实的SCSI设备，那只是被虚拟出来用于相应SCSI协议的。FC和SCSI的关系就像是汉语与电话线路的关系；

**9、组成FC通道的主要三个设备**：
  
a>光纤;
  
b>接口卡（Host Bus Adaptor）,负责接受SCSI协议，并将其转化为光信号，组好网络头，负责错误处理。在OS看来它就是一个SCSI适配器；有些HBA卡可以支持多路径。另：在使用以太网传输的类iSCSI技术时，用TOE（TCP Offloading Engine）卡可以获得比普通的NIC（Network Interface Card）更好的性能（因为帮OS干了点解包的活）；
  
c>光纤交换机（用于组织光纤网络），它要负责网络关系的任务，同时扮演Switch、Login Server、Name Server、Time Server、Alias Server的角色，光纤通信能达到100km的距离（相比之下SCSI的长度为1.5-12m）；

**10、跑iSCSI协议的以太网的性能**，如果线路达到10GB的话，就十分接近SCSI协议的FC网络了，特别是再加上TOE卡帮忙解头；

**11、iSCSI协议的优点**有二：
  
a>便宜；
  
b>可路由，因此可以组织较为复杂的网络环境，甚至在Internet上传输；

**12、NPS**（Network Power Switch），这是一种可网络控制的智能插座，可用于防止fail掉的系统继续往共享存储里面写数据；

**13、IPMI**。1998年Intel、DELL、HP及NEC共同提出IPMI规格，可以透过网络远端控制温度、电压；

**14、关闭ACPI的方法**：service scpid stop && chkconfig acpid off；

**15、红帽设计RHCS（红帽集群套件）的几个要点**：
  
a>心跳线路一定要和节点间互相通信的线路在一起；
  
b>DNS信息被放在配置文件里在节点间互相传递；
  
c>服务网络要和集群内部的网络分开（这样才方便去做自动配置对外服务的浮动ip等事情）；
  
d>监控对外服务器的网卡状态，防止对外服务失控；
  
e>用多网卡做bond backup防止网卡导致的通信断开；
  
d>利用多播降低集群内通信复杂度（必须要得到网络的硬件设备对多播的支持）；

**16、广播vs组播**：
  
a>广播是one-to-all，组播是one-to-many；
  
b>组播组一般定义在一个224.0.0.0/4的ip地址上；
  
c>接受者可自由加入退出组播组，发送者无法指定接受者；
  
d>由于不感兴趣的人不会接收到包，组播比广播更有效率；
  
e>Internet路由禁止广播；
  
f>IPv6中取消了广播，只有组播；

**17、网卡Bond**可以配置为热备或者负载均衡模式，后者约能达到单网卡效率的130% ~ 170%；

**18、bond备份在坏掉的时候不是无缝切换的**，需要等待几秒钟（主要是等待交换机里的路由表过期时间）；（???）

**19、多路径**在RHEL4.4之后包含的RHCS中支持了；

**20、关于安全性**的：
  
a>集群内部使用多播通信；
  
b>通信默认全都加密（使用主机名做key）；
  
c>使用OenAIS；
  
d>RHCS同时使用tcp和udp（在不同的信息上）；

**21、RHCS被默认包含在RHEL发行版中。**